<div
  class="flex items-center gap-2"
  x-data={"{text: '#{@verb_already || l("Following")}'}"}
  title={@title}
>
  {#if @my_follow == nil and current_user_id(@__context__)}
    <button disabled class="normal-case rounded-full btn btn-disabled btn-sm">{l("loading...")}</button>
  {#elseif !@my_follow}
    <a
      :if={!@my_follow}
      data-cid={@id}
      data-id="follow"
      id={"#{@id}-btn"}
      :on-click={if !@disabled, do: "Bonfire.Social.Follows:follow"}
      href={if !current_user_id(@__context__), do: "#{@path}/follow"}
      rel="noopener noreferrer"
      phx-disable-with={l("loading...")}
      phx-value-id={@object_id}
      class={
        e(@class, "btn btn-sm btn-primary rounded-full border-base-content/40 normal-case"),
        "btn-disabled": @disabled
      }
    >
      <div id={@id} class="flex items-center gap-2">
        <#Icon solid="UserAdd" :if={!@hide_icon} class={e(@icon_class, "w-4 h-4 shrink-0")} />
        <span :if={!@hide_text} class={"truncate ellipsis", "ml-2": !@hide_icon}>
          {@verb || l("Follow")} {@label}</span>
      </div>
    </a>
  {#elseif @my_follow == :requested}
    <span x-data={"{text: '#{l("Requested")}'}"}>
      <a
        x-on:mouseover={"text = '#{l("Cancel")}'"}
        x-on:mouseover.away={"text = '#{l("Requested")}'"}
        data-cid={@id}
        data-id="unfollow"
        :on-click={if !@disabled, do: "Bonfire.Social.Follows:unfollow"}
        phx-value-id={@object_id}
        :class={"{ '!btn-error': text == '#{l("Cancel")}' }"}
        class={
          e(@class, "btn btn-sm btn-outline rounded-full !border-base-content/40 normal-case"),
          "btn-disabled": @disabled
        }
      >
        <#Icon solid="UserRemove" :if={!@hide_icon} class={e(@icon_class, "w-4 h-4 shrink-0")} />

        <span :if={!@hide_text} x-text="text" class={"truncate ellipsis", "ml-2": !@hide_icon}>
          {l("Requested")} {@label}</span>
      </a>
    </span>
  {#else}
    <span>
      <a
        phx-disable-with={l("loading...")}
        x-on:mouseover={"text = '#{@verb_undo || l("Unfollow")}'"}
        x-on:mouseover.away={"text = '#{@verb_already || l("Following")}'"}
        id={"#{@id}-btn"}
        data-cid={@id}
        data-id="unfollow"
        :on-click={if !@disabled, do: "Bonfire.Social.Follows:unfollow"}
        phx-value-id={@object_id}
        :class={"text == '#{@verb_undo || l("Unfollow")}' ? '!btn-error' : ''"}
        class={
          e(@class, "btn btn-sm btn-outline rounded-full !border-base-content/40 normal-case"),
          "btn-disabled": @disabled
        }
      >
        <div id={@id} class="flex items-center gap-2">
          <#Icon solid="UserRemove" :if={!@hide_icon} class={e(@icon_class, "w-4 h-4 shrink-0")} />

          <span :if={!@hide_text} x-text="text" class={"truncate ellipsis", "ml-2": !@hide_icon}>
            {@verb_already || l("Following")} {@label}</span>
        </div>
      </a>
    </span>

    <#slot {@if_followed} />
  {/if}
</div>